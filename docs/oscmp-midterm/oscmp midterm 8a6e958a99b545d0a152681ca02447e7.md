# oscmp midterm

# ç›®æ ‡æè¿°

æœ¬é¡¹ç›®ä½¿ç”¨ aster-frame å¤åˆ» seL4

- ä¸€ä¸ªå°å‹çš„å¾®å†…æ ¸
- å…¼å®¹ seL4 çš„ç”¨æˆ·ç¨‹åº
- æ»¡è¶³ aster-frame çš„è¦æ±‚(å°†é»‘æš—çš„ "unsafe rust" åªç•™åœ¨å…¶ä¸­)

# æ¯”èµ›é¢˜ç›®åˆ†æå’Œç›¸å…³èµ„æ–™è°ƒç ”

## é¡¹ç›®éš¾ç‚¹

å®¢è§‚

1. seL4 ä»“åº“æ•°é‡å¤šï¼Œæ„å»ºç³»ç»Ÿå¤æ‚
2. safe rust éœ€è¦å¯¹ seL4 çš„æ ¸å¿ƒæ•°æ®ç»“æ„è¿›è¡Œé‡æ–°åŒ…è£…ï¼Œå¹¶ä¸”åœ¨ memory layout ä¸Šä¸åŸæ¥çš„ C ç»“æ„ä¿æŒä¸€è‡´ï¼ˆå…¼å®¹ seL4 user libsï¼‰

ä¸»è§‚

1. å¯¹äº x86 ç»“æ„ä¸å¤Ÿç†Ÿæ‚‰ï¼Œä¹‹å‰çš„èƒŒæ™¯éƒ½æ˜¯åŸºäº RISCV
2. å¯¹äº seL4 æ²¡æœ‰åŸºç¡€å¾—ä»å¤´å¼€å§‹å­¦ä¹ 
3. aster-frame ä¸­ç”¨äº†å¤§é‡ rust unstable feature ï¼Œè¿™äº› feature çš„æ–‡æ¡£æ¯”è¾ƒå°‘ï¼Œåªèƒ½é€šè¿‡ github tracking issue é€ä¸ªåˆ†æ

## aster-frame

aster-frame åŒ…å«äº†å†…æ ¸å¯åŠ¨ï¼Œç¡¬ä»¶åˆå§‹åŒ–ç­‰ç›¸å…³ä»£ç  ï¼Œç®€åŒ–äº†å†…æ ¸çš„å¼€å‘ï¼Œå¹¶ä¸”å°†unsafe rust ä»£ç è¿›è¡Œå°è£…æä¾›äº†é«˜çº§å®‰å…¨çš„æŠ½è±¡ã€‚

## seL4ç®€ä»‹

seL4 è®¾è®¡ç›®çš„æ˜¯ä¸ºå„ç§åº”ç”¨ç¨‹åºé¢†åŸŸçš„ç³»ç»Ÿæä¾›å®‰å…¨ã€å¯é çš„åŸºç¡€ã€‚ä½œä¸ºå¾®å†…æ ¸ï¼Œå®ƒä¸ºåº”ç”¨ç¨‹åºæä¾›äº†å°‘é‡æœåŠ¡ï¼Œå¦‚åˆ›å»ºå’Œç®¡ç†è™šæ‹Ÿåœ°å€ç©ºé—´ã€çº¿ç¨‹å’Œè¿›ç¨‹é—´é€šä¿¡(IPC)çš„æŠ½è±¡ã€‚åœ¨ ARM æ¶æ„ä¸‹çš„seL4å¤§çº¦åªæœ‰ 8700 è¡Œã€‚è¿™ä½¿å¾—ARMv6ç‰ˆæœ¬çš„å†…æ ¸å¯ä»¥åœ¨ Isabelle/HOL å®šç†è¯æ˜å™¨ä¸­æä¾›å½¢å¼åŒ–è¯æ˜ã€‚å†…æ ¸è¾ƒå°çš„ä½“ç§¯ä¹Ÿæœ‰åŠ©äºå¯¹æœ€åæƒ…å†µä¸‹çš„æ‰§è¡Œæ—¶é—´è¿›è¡Œå®Œæ•´è€Œå¯é çš„åˆ†æã€‚

seL4 å°†ç³»ç»Ÿä¸­çš„åŠŸèƒ½æŠ½è±¡ä¸ºå†…æ ¸å¯¹è±¡ï¼Œè€Œå¯¹è¿™äº›å¯¹è±¡è¿›è¡Œæ“ä½œåˆ™éœ€è¦ Capabilityï¼Œ æ¯”å¦‚åˆ†é¡µï¼Œ å¦‚æœç”¨æˆ·ç¨‹åºæ‹¥æœ‰è‡ªå·± VSpace Cap ï¼Œåˆ™ç”¨æˆ·ç¨‹åºå¯ä»¥åœ¨å…¶ä¸­æ˜ å°„åˆ†é¡µä¸­é—´ç»“æ„ï¼Œåœ¨ X86 ä¸­å°±æ˜¯ pdpt ç­‰ã€‚

### å†…æ ¸å¯¹è±¡ ï¼ˆ Kernel Objects ï¼‰

- CNode
    
    > å­˜å‚¨ capabilityï¼Œå…è®¸çº¿ç¨‹è°ƒç”¨ç‰¹å®šå¯¹è±¡çš„æ–¹æ³•ã€‚æ¯ä¸ªCNodeéƒ½æœ‰å›ºå®šæ•°é‡çš„æ’æ§½ï¼Œå¤§å°æ˜¯2çš„ K æ¬¡å¹‚ï¼Œè¿™æ˜¯åœ¨CNodeåˆ›å»ºæ—¶ç¡®å®šçš„ã€‚æ’æ§½å¯ä»¥æ˜¯ç©ºçš„ï¼Œä¹Ÿå¯ä»¥åŒ…å«ä¸€ä¸ªèƒ½åŠ›ã€‚
    > 
- Thread Control Blocks
    
    > çº¿ç¨‹æ˜¯æ‰§è¡Œå•å…ƒï¼Œæ ¹æ®åº”ç”¨ç¨‹åºä¸å…¶ä»–çº¿ç¨‹çš„äº¤äº’æƒ…å†µï¼Œçº¿ç¨‹å¯ä»¥è¢«è°ƒåº¦ã€é˜»å¡ã€æœªé˜»å¡ç­‰ã€‚
    > 
- Endpoints
    
    > ç”¨æ¥çº¿ç¨‹ä¹‹é—´çš„æ¶ˆæ¯ä¼ é€’é€šä¿¡ã€‚IPCæ˜¯åŒæ­¥çš„ï¼šä¸€ä¸ªçº¿ç¨‹è¯•å›¾åœ¨ä¸€ä¸ª endpoint ä¸Šå‘é€æˆ–æ¥æ”¶æ¶ˆæ¯ä¼šå‘ç”Ÿé˜»å¡ã€‚è¿™æ„å‘³ç€ï¼Œåªæœ‰åœ¨å‘é€æ–¹å’Œæ¥æ”¶æ–¹åŒæ—¶ä½¿ç”¨ endpoint æ—¶ï¼Œæ¶ˆæ¯ä¼ é€’æ‰ä¼šè¿›è¡Œï¼Œè€Œå†…æ ¸å¯ä»¥åªä½¿ç”¨ä¸€ä¸ªå‰¯æœ¬æ¥ä¼ é€’æ¶ˆæ¯(å¯¹äºçŸ­æ¶ˆæ¯ï¼Œåˆ™ä¸ä½¿ç”¨å¤åˆ¶ï¼Œåªä½¿ç”¨å¯„å­˜å™¨)ã€‚endpoint çš„ capabiliy å¯ä»¥è¢«é™åˆ¶ä¸ºä»…å‘é€æˆ–ä»…æ¥æ”¶ã€‚æ­¤å¤–ï¼Œç«¯ç‚¹åŠŸèƒ½å¯ä»¥å…·æœ‰grantæƒé™ï¼Œè¿™å…è®¸å°†å‘é€ capability ä½œä¸ºæ¶ˆæ¯çš„ä¸€éƒ¨åˆ†ã€‚
    > 
- Notification Objects
    
    > æä¾›ä¸€ä¸ªç®€å•çš„ä¿¡å·æœºåˆ¶ã€‚notification æ˜¯ä¸€ä¸ªå­—å¤§å°çš„æ ‡å¿—æ•°ç»„ï¼Œæ¯ä¸ªæ ‡å¿—çš„è¡Œä¸ºç±»ä¼¼äºäºŒè¿›åˆ¶ä¿¡å·é‡ã€‚
    > 
- Virtual Address Space Objects
    
    > ç”¨æ¥æ„é€ ä¸€ä¸ªè™šæ‹Ÿçš„ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹çš„åœ°å€ç©ºé—´(æˆ–VSpace)ã€‚è¿™äº›å¯¹è±¡åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šç›´æ¥å¯¹åº”äºç¡¬ä»¶ï¼Œå› è€Œæ˜¯ä½“ç³»ç»“æ„ç›¸å…³çš„ã€‚å†…æ ¸è¿˜åŒ…æ‹¬ASIDæ± å’ŒASIDæ§åˆ¶å¯¹è±¡ï¼Œç”¨äºè·Ÿè¸ªåœ°å€ç©ºé—´çš„çŠ¶æ€ã€‚
    > 
- Interrupt Objects
    
    > ç»™äºˆåº”ç”¨ç¨‹åºæ¥æ”¶ä¸­æ–­ã€‚æœ€åˆï¼ŒIRQControlåªæœ‰ä¸€ä¸ª capability ï¼Œå®ƒå…è®¸åˆ›å»ºIRQHandler ã€‚IRQHandler capability å…è®¸ç®¡ç†ä¸ç‰¹å®šè®¾å¤‡å…³è”çš„ç‰¹å®šä¸­æ–­æºã€‚å®ƒå§”æ‰˜ç»™ä¸€ä¸ªè®¾å¤‡é©±åŠ¨ç¨‹åºæ¥è®¿é—®ä¸­æ–­æºã€‚IRQHandlerå¯¹è±¡å…è®¸çº¿ç¨‹ç­‰å¾…å’Œç¡®è®¤å„ä¸ªä¸­æ–­ã€‚
    > 
- Untyped Memory
    
    > seL4å†…æ ¸å†…å­˜åˆ†é…çš„åŸºç¡€ã€‚å†…æ ¸åªæä¾›ä¸€ç§æ–¹æ³•åˆ›å»ºæ–°çš„å†…æ ¸å¯¹è±¡ã€‚å¦‚æœæ–¹æ³•æˆåŠŸï¼Œè°ƒç”¨çº¿ç¨‹å°†è·å¾—å¯¹æ–°åˆ›å»ºå¯¹è±¡çš„è®¿é—®æƒé™ã€‚æ­¤å¤–ï¼ŒUntyped Memory å¯¹è±¡å¯ä»¥åˆ’åˆ†ä¸ºä¸€ç»„è¾ƒå°çš„ Untyped Memory å¯¹è±¡ï¼Œå…è®¸å§”æ‰˜ç³»ç»Ÿçš„éƒ¨åˆ†(æˆ–å…¨éƒ¨)å†…å­˜ã€‚
    > 

### Capability

capability æ˜¯å”¯ä¸€çš„ã€ä¸å¯ä¼ªé€ çš„ä»¤ç‰Œï¼Œå®ƒèµ‹äºˆæ‰€æœ‰è€…è®¿é—®ç³»ç»Ÿä¸­çš„å®ä½“æˆ–å¯¹è±¡çš„æƒé™ã€‚å¯ä»¥å°†å…¶è§†ä¸ºä¸€ç§å…·æœ‰è®¿é—®æƒé™çš„æŒ‡é’ˆã€‚

åœ¨ seL4 ä¸­æœ‰ä¸‰ç±» capability :

- å¯ä»¥è®¿é—®å†…æ ¸å¯¹è±¡çš„ capabilities,
- æ§åˆ¶å†…æ ¸æŠ½è±¡èµ„æºçš„ capabilities å¦‚ IRQControl
- è´Ÿè´£ç®¡ç†ç‰©ç†å†…å­˜çš„ untyped capabilities

åœ¨ seL4 å†…æ ¸åˆå§‹åŒ–å®Œæˆä¹‹åä¼šå°†æ•´ä¸ªç³»ç»Ÿä¸­çš„æ‰€æœ‰èƒ½åŠ›ä¼ ç»™ root taskã€‚

### Addressing

ç”¨æˆ·å¯ä»¥é€šè¿‡ Invocation å’Œ Direct CSpace addressing çš„æ–¹å¼æ¥å¯»æ‰¾ capability ã€‚

- invocation å°±æ˜¯é€šè¿‡éšå¼ä½¿ç”¨ thread çš„ cspace root è¿›è¡Œå¯»æ‰¾
- direct å³ç›´æ¥æŒ‡å®š CNode

æœªå®Œå¾…ç»­

# ç³»ç»Ÿæ¡†æ¶è®¾è®¡

**æ³¨æ„ï¼šæš‚æ—¶ä¸å®ç° MCS æœºåˆ¶ï¼Œ å¹¶ä¸” aster-frame ç›®å‰ä¸æ”¯æŒ Thread Local Storage**

æ•´ä½“ä¸Šé¡¹ç›®æœ‰ç‚¹åƒç”¨ Rust é‡å†™ seL4 ï¼Œå¼€æºç¤¾åŒºä¸­ä¹Ÿæœ‰è¿™æ ·çš„ç»éªŒï¼Œæ¯”å¦‚ [DragonOS](https://dragonos.org/) ä½¿ç”¨ Rust é‡å†™äº† C ä»£ç ã€‚ä¸€èˆ¬æ¥è¯´å¯ä»¥ä½¿ç”¨ rust-ffi å…ˆå°†ä¸€éƒ¨åˆ†ä»£ç ä¸åŸæ¥çš„ C ä»£ç è¿›è¡Œé“¾æ¥æ¥è¿›è¡Œæ›¿æ¢ã€‚ä½†æ˜¯è€ƒè™‘åˆ°è¦ä½¿ç”¨ aster-frame æˆ‘ä»¬æ²¡æœ‰é‡‡ç”¨è¿™æ ·çš„æ–¹å¼ã€‚

## v1

åœ¨é¡¹ç›®å¼€å§‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¿˜ä¸ç†Ÿæ‚‰ seL4 çš„åŸç†ï¼Œæ•…å¼€å§‹ç®€å•ç²—æš´çš„å°† seL4 ä¸­çš„ C ä»£ç ç›´æ¥ç¿»è¯‘æˆ Rust ä»£ç ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯ä¸ä¼šæµªè´¹æ—¶é—´å¹¶ä¸”èƒ½å¤Ÿå¯¹ seL4 èƒ½æœ‰ä¸€ä¸ªå…¨å±€æ€§çš„è®¤è¯†ï¼Œç¼ºç‚¹æ˜¯ä¹‹åå¿…é¡»è¿›è¡Œé‡æ„ã€‚å‚è€ƒäº† aster-nix ï¼ˆä½¿ç”¨ aster-frame å®ç°çš„å…¼å®¹ linux çš„å®å†…æ ¸ï¼‰å­¦ä¹  aster-frame api çš„å…·ä½“ç”¨æ³•ï¼Œå¹¶ä¸”é‡‡ç”¨äº† aster-nix ä¸­ processï¼Œthreadï¼Œvmarï¼Œvmo çš„æŠ½è±¡

## v2

é‡æ„è®¡åˆ’ï¼Œå‡†å¤‡ä½¿ç”¨sel4-sys è¿™ä¸ªåº“æ¥æä¾› sel4 ä¸­æœ€åŸºæœ¬çš„ä¸€äº›æ•°æ®ç»“æ„ï¼Œç„¶ååœ¨å…¶ä¸Šæ„å»ºå‡º seL4ä¸­ä¸€ä¸ªä¸ªå†…æ ¸å¯¹è±¡çš„ Rusty ç‰ˆæœ¬ã€‚sel4-sys æ˜¯ seL4 åŸºé‡‘ä¼šæ”¯æŒçš„ä¸€ä¸ª seL4 rust bindingï¼Œä¸»è¦æ˜¯è®© rust èƒ½å¤Ÿå†™ seL4 çš„ç”¨æˆ·ç¨‹åºè€Œä¸æ˜¯å†…æ ¸ã€‚é‡å†™ä¸€äº› aster-frame ä¸­çš„æŠ½è±¡ï¼Œæ¯”å¦‚ PageTableï¼Œaster-frame ä¸­çš„ page table æ˜¯å¯¹è™šæ‹Ÿå†…å­˜å¾ˆå¥½çš„æŠ½è±¡ä½†æ˜¯åœ¨ seL4 ä¸­ç”±äº capability çš„å­˜åœ¨ï¼Œå®ƒçš„çµæ´»æ€§å°±ç¨æ˜¾ä¸è¶³äº†ã€‚

æœªå®Œå¾…ç»­

# é‡åˆ°çš„ä¸»è¦é—®é¢˜å’Œè§£å†³æ–¹æ³•

1. åœ¨ç”±äºä½¿ç”¨äº†aster-frameï¼Œæ‰€ä»¥æ‰€æœ‰çš„ç©ºé—²å†…å­˜éƒ½æ˜¯è¢« aster-frame ä¸­çš„å†…å­˜åˆ†é…å™¨ç®¡ç†çš„å†…æ ¸æ˜¯ä¸èƒ½ç›´æ¥ä½¿ç”¨çš„ï¼Œåœ¨ç»™ root task ä¼ æ‰€æœ‰çš„ç‰©ç†å†…å­˜æ—¶å‡ºç°äº†é—®é¢˜ï¼ŒseL4 ä¸­ä¼šå°†æ‰€æœ‰çš„ç©ºé—²å†…å­˜ä»¥ Untyped Memory çš„æ–¹å¼ç»™åˆ° root taskï¼Œ v1 ä¸­åªèƒ½å°†ç©ºé—²å†…å­˜ä»¥ vmo çš„æ–¹å¼æ˜ å°„ç»™ root task çš„é¡µè¡¨ã€‚ä¸ seL4 çš„è¡Œä¸ºä¸ä¸€è‡´
2. åœ¨ seL4 ä¸­å°† root task elf æ”¾åˆ°ä¸€ä¸ªç‰¹å®šçš„å†…å­˜åœ°å€ä¹‹åä¼šå¼€å§‹ä¸ºå…¶æ„é€ é¡µè¡¨å’Œç›¸åº”çš„èƒ½åŠ›ï¼Œè€Œåœ¨ v1 ä¸­æ˜¯æ„é€ é¡µè¡¨å†ä»å…¶ä¸­ç”Ÿæˆå‡º pml4ï¼Œpdptï¼Œpdï¼Œpt ç­‰èƒ½åŠ›

# ç³»ç»Ÿæµ‹è¯•æƒ…å†µ

æœ€ç»ˆç›®æ ‡èƒ½å¤Ÿé€šè¿‡ seL4test

ç›®å‰åªèƒ½ç»™è¿è¡Œ seL4 tutorialä¸­ç®€å•çš„ç¨‹åº

# å¼€å‘è®¡åˆ’

- [x]  2024.4.11 - 2024.4.18
åˆ†æ aster-frame ç›¸å…³ä»£ç å’Œæ–‡æ¡£ï¼Œé…ç½®å¼€å‘ç¯å¢ƒ
- [x]  2024.04.18 - 2024.04.22
é˜…è¯» seL4 å®˜ç½‘çš„æ–‡æ¡£å’Œæ‰‹å†Œï¼Œæ­å»º seL4 çš„å¼€å‘ç¯å¢ƒï¼Œå¹¶ä¸”æ„å»ºè¿è¡Œ
- [x]  2024.04.22 - 2024.4.29
å°† seL4 ä¸»ä½“ä»£ç ç¿»è¯‘ä¸º Rust
- [x]  2022.05.13 - 2022.5.23
ä½¿ç”¨ aster-frame å¯åŠ¨ç³»ç»Ÿï¼Œè°ƒè¯• kernel å’Œ root task
- [x]  2022.05.24-2022.5.25
å®Œå–„ç›¸å…³æŠ€æœ¯æ–‡æ¡£ã€‚
- [ ]  2022.05.26 -
é‡æ„ Rust ä»£ç ï¼Œ æ‰“ç£¨ç³»ç»Ÿç»†èŠ‚

# ä¸­æœŸå¼€å‘çŠ¶æ€

[**ç‚¹å‡»æ­¤å¤„æŸ¥çœ‹æ¼”ç¤ºè§†é¢‘**](https://pan.baidu.com/s/1WcrzGCPzr5pznlpo4_jIRQ?pwd=wp6t)

**æµ‹è¯•åˆ†æï¼š**

```c
æµ‹è¯•ä»£ç 
/*
 * Copyright 2018, Data61, CSIRO (ABN 41 687 119 230).
 *
 * SPDX-License-Identifier: BSD-2-Clause
 */

/*
 * seL4 tutorial part 2: create and run a new thread
 */

/* Include config variables. */
#include <autoconf.h>

#include <assert.h>
#include <stdio.h>

#include <sel4/sel4.h>

#include <simple-default/simple-default.h>
#include <simple/simple.h>

#include <vka/object.h>

#include <allocman/allocman.h>
#include <allocman/bootstrap.h>
#include <allocman/vka.h>

#include <sel4utils/sel4_zf_logif.h>
#include <sel4utils/thread.h>
#include <utils/arith.h>
#include <utils/zf_log.h>

#include <sel4platsupport/bootinfo.h>

/* global environment variables */

/* seL4_BootInfo defined in bootinfo.h */
seL4_BootInfo *info;

/* simple_t defined in simple.h */
simple_t simple;

/* vka_t defined in vka.h */
vka_t vka;

/* allocman_t defined in allocman.h */
allocman_t *allocman;

/* static memory for the allocator to bootstrap with */
#define ALLOCATOR_STATIC_POOL_SIZE (BIT(seL4_PageBits) * 10)
UNUSED static char allocator_mem_pool[ALLOCATOR_STATIC_POOL_SIZE];

int main(void) {
  UNUSED int error = 0;

  /* TASK 1: get boot info */
  /* hint: platsupport_get_bootinfo()
   * seL4_BootInfo* platsupport_get_bootinfo(void);
   * @return Pointer to the bootinfo, NULL on failure
   */

  info = platsupport_get_bootinfo();
  ZF_LOGF_IF(info == NULL, "Failed to get bootinfo.");

  /* TASK 2: initialise simple object */
  /* hint: simple_default_init_bootinfo()
   * void simple_default_init_bootinfo(simple_t *simple, seL4_BootInfo *bi);
   * @param simple Structure for the simple interface object. This gets
   * initialised.
   * @param bi Pointer to the bootinfo describing what resources are available
   */

  simple_default_init_bootinfo(&simple, info);
 
  /* TASK 3: print out bootinfo and other info about simple */
  /* hint: simple_print()
   * void simple_print(simple_t *simple);
   * @param simple Pointer to simple interface.
   */

  simple_print(&simple);
  return 0;
}
```

ä¸Šè¿°ä»£ç ä¸»è¦æ˜¯æ‰“å°å†…æ ¸ä¼ é€’å‡ºæ¥çš„ BootInfo

seL4Runtime ä¼šå…ˆåšä¸€äº› C è¯­è¨€è¿è¡Œæ—¶çš„åˆå§‹åŒ–å·¥ä½œã€‚

![Untitled](oscmp%20midterm%208a6e958a99b545d0a152681ca02447e7/Untitled.png)

ä¸ seL4 ç»“æœå¯¹æ¯”ï¼š

![Untitled](oscmp%20midterm%208a6e958a99b545d0a152681ca02447e7/Untitled%201.png)

# åˆ†å·¥å’Œåä½œ

é™ˆå˜‰é‘«ï¼šæ–¹æ¡ˆåˆ¶å®šï¼Œå†…æ ¸ä»£ç ç¼–å†™ï¼Œæ–‡æ¡£ç¼–å†™

é™ˆç›Šå…µï¼šseL4 CMake åˆ†æ

é¡¾é¹é£ï¼šç›¸å…³æµ‹è¯•ä»£ç ç¼–å†™

# æäº¤ä»“åº“ç›®å½•å’Œæ–‡ä»¶æè¿°

```
â”œâ”€â”€ antimono                                                               // anti monolithic kernel is micro kernel ğŸ¤”
â”‚   â”œâ”€â”€ asm                                                                // assemberly
â”‚   â”‚   â”œâ”€â”€ kernel.asm
â”‚   â”‚   â””â”€â”€ user.asm
â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â”œâ”€â”€ crates                                                             // dep crates
â”‚   â”‚   â”œâ”€â”€ align-ext                                                      // aster-frame deps
â”‚   â”‚   â”œâ”€â”€ anti-frame                                                     // aster-frame fork
â”‚   â”‚   â”œâ”€â”€ anti-main                                                      // aster-frame deps
â”‚   â”‚   â”œâ”€â”€ anti-rights                                                    // aster-frame deps
â”‚   â”‚   â”œâ”€â”€ anti-rights-proc                                               // aster-frame deps
â”‚   â”‚   â”œâ”€â”€ anti-util                                                      // aster-frame deps
â”‚   â”‚   â”œâ”€â”€ id-alloc                                                       // aster-frame deps
â”‚   â”‚   â”œâ”€â”€ int-to-c-enum                                                  // aster-frame deps
â”‚   â”‚   â”œâ”€â”€ sel4                                                           // sel4 rust user-level libs
â”‚   â”‚   â”‚   â”œâ”€â”€ bitfield-ops
â”‚   â”‚   â”‚   â”œâ”€â”€ bitfield-parser
â”‚   â”‚   â”‚   â”œâ”€â”€ build-env
â”‚   â”‚   â”‚   â”œâ”€â”€ Cargo.nix
â”‚   â”‚   â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â”‚   â”‚   â”œâ”€â”€ config
â”‚   â”‚   â”‚   â”œâ”€â”€ src
â”‚   â”‚   â”‚   â””â”€â”€ sys                                                        // sel4 c bindings
â”‚   â”‚   â”œâ”€â”€ sel4-rustfmt-helper
â”‚   â”‚   â”œâ”€â”€ typeflags
â”‚   â”‚   â””â”€â”€ typeflags-util
â”‚   â”œâ”€â”€ ember                                                              // the sel4 fork kernel
â”‚   â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â”‚   â””â”€â”€ src
â”‚   â”‚       â”œâ”€â”€ boot                                                       // userless moved in sel4 mod
â”‚   â”‚       â”œâ”€â”€ c_api.rs                                                   // userless moved in sel4 mod
â”‚   â”‚       â”œâ”€â”€ common                                                     // userless moved in sel4 mod
â”‚   â”‚       â”œâ”€â”€ common.rs                                                  // userless moved in sel4 mod
â”‚   â”‚       â”œâ”€â”€ config.rs                                                  // userless moved in sel4 mod
â”‚   â”‚       â”œâ”€â”€ cspace                                                     // userless moved in sel4 mod
â”‚   â”‚       â”œâ”€â”€ cspace.rs                                                  // userless moved in sel4 mod
â”‚   â”‚       â”œâ”€â”€ debug.rs                                                   // userless moved in sel4 mod
â”‚   â”‚       â”œâ”€â”€ deps.rs                                                    // userless moved in sel4 mod
â”‚   â”‚       â”œâ”€â”€ error.rs                                                   // system errors
â”‚   â”‚       â”œâ”€â”€ exception.rs                                               // userless moved in sel4 mod
â”‚   â”‚       â”œâ”€â”€ interrupt                                                  // userless moved in sel4 mod
â”‚   â”‚       â”œâ”€â”€ interrupt.rs                                               // userless moved in sel4 mod
â”‚   â”‚       â”œâ”€â”€ kernel                                                     // userless moved in sel4 mod
â”‚   â”‚       â”œâ”€â”€ kernel.rs                                                  // userless moved in sel4 mod
â”‚   â”‚       â”œâ”€â”€ lib.rs
â”‚   â”‚       â”œâ”€â”€ object.rs                                                  // userless moved in sel4 mod
â”‚   â”‚       â”œâ”€â”€ process                                                    // process related
â”‚   â”‚       â”‚    â”œâ”€â”€ mod.rs
â”‚   â”‚       â”‚    â”œâ”€â”€ process_builder.rs
â”‚   â”‚       â”‚    â”œâ”€â”€ process_vm
â”‚   â”‚       â”‚    â”œâ”€â”€ program_loader                                        // elf loader and parser
â”‚   â”‚       â”‚    â””â”€â”€ sel4_thread
â”‚   â”‚       â”œâ”€â”€ sched.rs                                                   // userless moved in sel4 mod
â”‚   â”‚       â”œâ”€â”€ sel4                                                       // sel4 raw fork
â”‚   â”‚       â”‚   â”œâ”€â”€ boot
â”‚   â”‚       â”‚   â”œâ”€â”€ common
â”‚   â”‚       â”‚   â”œâ”€â”€ cspace
â”‚   â”‚       â”‚   â”œâ”€â”€ exception
â”‚   â”‚       â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ utils
â”‚   â”‚       â”‚   â””â”€â”€ vspace
â”‚   â”‚       â”œâ”€â”€ syscall                                                    // syscalls
â”‚   â”‚       â”‚   â”œâ”€â”€ invocation
â”‚   â”‚       â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ sel4_syscalls
â”‚   â”‚       â”‚   â”‚   â””â”€â”€ mod.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ syscall_reply.rs
â”‚   â”‚       â”‚   â””â”€â”€ utils.rs
â”‚   â”‚       â”œâ”€â”€ task_manager                                               // useless replaced by thread
â”‚   â”‚       â”‚   â”œâ”€â”€ ipc
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ endpoint.rs
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ notification.rs
â”‚   â”‚       â”‚   â”‚   â””â”€â”€ transfer.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ ipc.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ registers.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ scheduler.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ structures.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ tcb.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ tcb_queue.rs
â”‚   â”‚       â”‚   â””â”€â”€ thread_state.rs
â”‚   â”‚       â”œâ”€â”€ thread                                                     // thread related
â”‚   â”‚       â”‚   â”œâ”€â”€ exception.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ kernel_thread.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ status.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ task.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ thread_table.rs
â”‚   â”‚       â”‚   â””â”€â”€ user.rs
â”‚   â”‚       â”œâ”€â”€ utils.rs
â”‚   â”‚       â”œâ”€â”€ vm                                                         // virtual memory will be refactored
â”‚   â”‚       â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ page_fault_handler.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ perms.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ vmar
â”‚   â”‚       â”‚   â””â”€â”€ vmo
â”‚   â”‚       â”œâ”€â”€ vspace                                                     // useless moved in sel4 mod
â”‚   â”‚       â”‚   â”œâ”€â”€ asid.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ interface.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ structures.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ utils.rs
â”‚   â”‚       â”‚   â””â”€â”€ vm_rights.rs
â”‚   â”‚       â””â”€â”€ vspace.rs
â”‚   â”œâ”€â”€ images                                                             // root task programs
â”‚   â”‚   â”œâ”€â”€ hello
â”‚   â”‚   â”œâ”€â”€ hello-bin
â”‚   â”‚   â”œâ”€â”€ hello.S
â”‚   â”‚   â””â”€â”€ root_task
â”‚   â”œâ”€â”€ justfile
â”‚   â”œâ”€â”€ OSDK.toml
â”‚   â”œâ”€â”€ README.md
â”‚   â”œâ”€â”€ rust-toolchain.toml
â”‚   â”œâ”€â”€ src
â”‚   â”‚   â””â”€â”€ lib.rs
â”œâ”€â”€ asterinas // aster git module
â”œâ”€â”€ OVMF // ed2k uefi related
â””â”€â”€ README.md

```

# å¯¼å¸ˆæ²Ÿé€šåŠæŒ‡å¯¼æƒ…å†µ

åœ¨2024å¹´4æœˆï¼Œå›¢é˜Ÿä¸é¡¹ç›®æŒ‡å¯¼ç”°æ•™å¸ˆï¼ˆç”°æ´ªäº®ï¼‰å¼€å§‹äº¤æµæ¯”èµ›ä¿¡æ¯ï¼Œé€‰æ‹©[proj306-åŸºäºæ¡†å†…æ ¸æ¶æ„çš„ Rust OSå®è·µå’Œåˆ›æ–°](https://github.com/oscomp/proj306-Rust-OS-for-Framekernel-Architecture)ã€‚

ç”°è€å¸ˆå’Œè’‹è€å¸ˆä¸€ç›´åœ¨å¾®ä¿¡ç¾¤é‡Œä¸ºæˆ‘ä»¬ç­”ç–‘å’ŒæŒ‡å¯¼ï¼Œååˆ†æ„Ÿè°¢ä¸¤ä½è€å¸ˆã€‚

æœ€åæ„Ÿè°¢æˆ‘çš„å¯¼å¸ˆåˆ˜é›…è¾‰è€å¸ˆå¯¹æˆ‘ä»¬çš„æ”¯æŒã€‚

# å‚è€ƒèµ„æ–™

[seL4 official siteï¼ˆmanual)](https://docs.sel4.systems/)

[asterinas repo](https://github.com/asterinas/asterinas)

[intel 64 developer manual](https://www.intel.com/content/www/us/en/developer/articles/technical/intel-sdm.html)

[rust-sel4 repo](https://github.com/seL4/rust-sel4)

# æ¯”èµ›æ”¶è·

- æ·±å…¥ç†è§£äº†å¾®å†…æ ¸çš„è®¾è®¡æ€æƒ³
- å­¦ä¹ äº† x86 æ¶æ„
- æé«˜äº†ç³»ç»Ÿè®¾è®¡èƒ½åŠ›
- å¯¹äº Rust æœ‰äº†æ–°çš„ç†è§£